# CI/CD
The Istio module contains several pipelines that run on pull requests, on the main branch, on the release branch, and periodically. They perform various tasks such as running a linter, executing unit tests with code coverage, generating artifacts for development and production purposes, and running integration tests. The integration tests ensure the functional correctness of Kyma Istio Operator and verify if upgrading to the new version of Kyma Istio Operator is possible.

## Enforcing that the Required Actions Always Run

To ensure that the required actions always run, the Istio module uses a GitHub ruleset. This enforces the execution of all jobs that determine whether a particular workflow should start.

By default, GitHub Actions that don't run because of reasons other than being skipped in the `if` statement have the `Pending` status and do not appear as a check in a PR. The ruleset acts as a safeguard to prevent situations when, for example, an external action is not allowed to run. In such cases, the ruleset ensures that the PR cannot be merged unless the check is executed and has a status of either `Skipped` or `Success`.

## Pipelines Running on Pull Requests to the Main Branch

The following CI jobs are part of the development cycle.

| Name                                                                                                                                                                                                         | Description                                                                                                                                                                            |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [`Pull Request pipeline / Build manager image`](https://github.com/kyma-project/istio/blob/6ce195c399990a8c820517635c82916cce917b2d/.github/workflows/pull-request.yaml#L32)                                 | Builds the manager image so that the image-dependent jobs can be executed.                                                                                                             |
| [`Pull Request integration tests / Istio integration test`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/pull-integration.yaml#L38)                 | Executes the integration test suites for the Istio module on a k3d cluster.                                                                                                            |
| [`Pull Request integration tests / Istio integration test evaluation`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/pull-integration.yaml#L57)      | Executes the evaluation integration test suite for the Istio module on a k3d cluster.                                                                                                  |
| [`Pull Request integration tests / Kubernetes version compatibility test`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/pull-integration.yaml#L10)  | Executes the integration test suites for the Istio module and checks if any incompatibilities occurred during the execution.                                                           |
| [`Pull Request integration tests / Istio upgrade integration test`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/pull-integration.yaml#L25)         | Executes the upgrade integration test suite for the Istio module on k3d cluster and verifies if the existing release can be successfully upgraded to the new version without downtime. |
| [`Pull Request unit & lint / lint`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-unit-lint.yaml#L9)                                            | Performs linting.                                                                                                                                                                      |
| [`Pull Request unit & lint / Run unit tests`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-unit-lint.yaml#L24)                                 | Runs unit tests with code coverage information.                                                                                                                                        |
| [`Pull Request unit & lint / Run unit tests with experimental build tag`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-unit-lint.yaml#L39)     | Runs unit tests with experimental build tag.                                                                                                                                           |
| [`PR Integration Gardener / Build and push manager image`](https://github.com/kyma-project/istio/blob/6ce195c399990a8c820517635c82916cce917b2d/.github/workflows/pull-integration-gardener.yaml#L36)         | Builds the managers's image and pushs it to a GCP Artifact Registry so that the jobs running tests on Gardener clusters can be executed.                                               |
| [`PR Integration Gardener / Istio integration test GCP`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/pull-integration-gardener.yaml#L53)           | Executes the integration test suites for the Istio module on a GCP Gardener cluster.                                                                                                   |
| [`PR Integration Gardener / Istio integration test AWS specific`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/pull-integration-gardener.yaml#L89)  | Executes the integration test suite specific for AWS Hyperscaler.                                                                                                                      |
| [`PR Integration Gardener / Istio integration test GCP specific`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/pull-integration-gardener.yaml#L120) | Executes the integration test suite specific for GCP Hyperscaler.                                                                                                                      |
| [`UI Tests / Run UI tests`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/call-ui-tests.yaml#L7)                                                          | Runs UI tests for Busola extensions of the Istio module.                                                                                                                               |
| [`Workflow validation / Ensure SHA pinned actions`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/call-verify-commit-pins.yaml#L7)                        | Verifies that all external actions are pinned to a commit.                                                                                                                             |
| [`Pull Request pipeline / gitleaks`](https://github.com/kyma-project/istio/blob/58c8333423e0c88c4de62ee4b15ba233af50f544/.github/workflows/pull-request.yaml#L10)                                            | Runs the Gitleaks scan to detect any leaks of secrets.                                                                                                                                 |
| [`Sync External Images / sync-external-images`](https://github.com/kyma-project/istio/blob/0a36feb5ef1383b248d9a59e8c22706204491e9d/.github/workflows/sync-external-images.yaml#L20)                         | Executes image syncer to import external images.                                                                                                                                       |

## Pipelines Running on Pull Requests to the Release Branch

The following CI jobs are part of the development cycle.

| Name                                                                                                                                                                                                                            | Description                                                                                                                                                                            |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [`Build manager image / Build manager image`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/release-pr.yaml#L8)                                                      | Builds Kyma Istio Operator's image and pushes it to the `dev` registry.                                                                                                                |
| [`Dispatch integration tests / Istio integration test`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-release-pr-integration.yaml#L65)                                | Executes the integration test suites for the Istio module on a k3d cluster.                                                                                                            |
| [`Dispatch integration tests / Istio integration test evaluation`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-release-pr-integration.yaml#L88)                     | Executes the evaluation integration test suite for the Istio module on a k3d cluster.                                                                                                  |
| [`Dispatch integration tests / Kubernetes version compatibility test`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-release-pr-integration.yaml#L30)                 | Executes the integration test suites for the Istio module and checks if any incompatibilities occurred during the execution.                                                           |
| [`Dispatch integration tests / Istio upgrade integration test`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-release-pr-integration.yaml#L48)                        | Executes the upgrade integration test suite for the Istio module on k3d cluster and verifies if the existing release can be successfully upgraded to the new version without downtime. |
| [`Dispatch unit test / Lint`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-unit-lint.yaml#L29)                                                                     | Performs linting.                                                                                                                                                                      |
| [`Dispatch unit test / Run unit tests`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-unit-lint.yaml#L46)                                                          | Runs unit tests with code coverage information.                                                                                                                                        |
| [`Dispatch unit test / Run unit tests with experimental build tag`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-unit-lint.yaml#L65)                              | Runs unit tests with experimental build tag.                                                                                                                                           |
| [`Dispatch Gardener integration tests / Istio integration test GCP`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-release-pr-integration-gardener.yaml#L27)           | Executes the integration test suites for the Istio module on a GCP Gardener cluster.                                                                                                   |
| [`Dispatch Gardener integration tests / Istio integration test AWS specific`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-release-pr-integration-gardener.yaml#L66) | Executes the integration test suite specific for AWS Hyperscaler.                                                                                                                      |
| [`Dispatch Gardener integration tests / Istio integration test GCP specific`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/call-release-pr-integration-gardener.yaml#L100) | Executes the integration test suite specific for GCP Hyperscaler.                                                                                                                      |
| [`Dispatch UI tests / Run UI tests`](https://github.com/kyma-project/istio/blob/47fd5e8dfd844b09aca95ec29bd39f200a207ec6/.github/workflows/call-ui-tests.yaml#L8)                                                                    | Runs UI tests for Busola extensions of the Istio module.                                                                                                                               |
| [`Dispatch verify-commit-pins / Ensure SHA pinned actions`](https://github.com/kyma-project/istio/blob/47fd5e8dfd844b09aca95ec29bd39f200a207ec6/.github/workflows/call-verify-commit-pins.yaml#L8)                                   | Verifies that all external actions are pinned to a commit.                                                                                                                             |

## Pipelines Running on Merge to Main branch

The following CI jobs run when you merge changes to the `main` branch.

| Name                                                                                                                                                                                               | Description                                                                                                                                                                                |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| [`main integration tests / Build manager image`](https://github.com/kyma-project/istio/blob/0a09540539f4683198dcfd4413bb9469e108b83b/.github/workflows/main-integration.yaml#L39)                  | Builds Kyma Istio Operator's image and pushes it to the `prod` registry.                                                                                                                   |
| [`main integration tests / Build manager image - experimental`](https://github.com/kyma-project/istio/blob/0a09540539f4683198dcfd4413bb9469e108b83b/.github/workflows/main-integration.yaml#L52)   | Builds Kyma Istio Operator's experimental image and pushes it to the `prod` registry.                                                                                                      |
| [`main integration tests / Istio integration test`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/main-integration.yaml#L80)               | Executes the integration test suites for the Istio module on a k3d cluster.                                                                                                                |
| [`main integration tests / Istio integration test AWS specific`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/main-integration.yaml#L134) | Executes the integration test suite specific for AWS Hyperscaler.                                                                                                                          |
| [`main integration tests / Istio integration test GCP specific`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/main-integration.yaml#L164) | Executes the integration test suite specific for AWS Hyperscaler.                                                                                                                          |
| [`main integration tests / Istio integration test AWS`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/main-integration.yaml#L194)          | Executes the integration test suites for the Istio module on a AWS Gardener cluster.                                                                                                       |
| [`main integration tests / Istio integration test GCP`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/main-integration.yaml#L99)           | Executes the integration test suites for the Istio module on a GCP Gardener cluster.                                                                                                       |
| [`main integration tests / Istio upgrade integration tests`](https://github.com/kyma-project/istio/blob/61f4792ec737a96ce68eaf774c7214ad6f09d8e1/.github/workflows/main-integration.yaml#L67)      | Executes the upgrade integration test suite of Istio Module on GCP Gardener cluster and verifies if the existing release can be successfully upgraded to the new version without downtime. |
| [`main integration tests / Slack Notification`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/main-integration.yaml#L193)                  | Sends a Slack notification to the team's channel if any pipelines fail on the main branch.                                                                                                 |

## Pipelines Running Only on Merge to Main

The following CI jobs run when you merge changes to the `main` branch.

| Name                                              | Description                                      |
|---------------------------------------------------|--------------------------------------------------|
| [`Sync External Images / sync-external-images`](https://github.com/kyma-project/istio/blob/0a36feb5ef1383b248d9a59e8c22706204491e9d/.github/workflows/sync-external-images.yaml#L20) | Executes image syncer to import external images. |

## Pipelines Running During the Release Process

The following CI jobs generate release artifacts and verify the functional correctness of Kyma Istio Operator.

| Name                                                                                                                                                                            | Description                                                                                          |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| [`Create Release / Check release prerequisites`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/release-create-release.yaml#L16) | Checks whether all pre-requesites for release are met                                                |
| [`Create Release / build-image`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/release-create-release.yaml#L42)                 | Builds Kyma Istio Operator's image on the release and pushes it to the `prod` registry.              |
| [`Create Release / build-image-experimental`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/release-create-release.yaml#L53)    | Builds Kyma Istio Operator's experimental image on the release and pushes it to the `prod` registry. |
| [`Create Release / Create draft release`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/release-create-release.yaml#L75)        | Create a draft release that will be updated with release artifacts                                   |
| [`Create Release / Publish release`](https://github.com/kyma-project/istio/blob/42d84359f5af55a1fe2d547eeb942d9780695cdd/.github/workflows/release-create-release.yaml#L108)             | Publish the previously created draft release                                                         |

## Pipelines Running on a Schedule

The following CI jobs are scheduled to run at specific times.

| Name                                                                                                                                                                                 | Description                                                                                                 |
|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-------------------------------------------------------------------------------------------------------------|
| [`main performance tests / Build manager image`](https://github.com/kyma-project/istio/blob/9ea276c90ae787be6376cfd6935e8e0662df242a/.github/workflows/schedule-performance-test.yaml#L10)                  | Builds Kyma Istio Operator's image and pushes it to the `prod` registry. |
| [`main performance tests / Istio performance test`](https://github.com/kyma-project/istio/blob/9ea276c90ae787be6376cfd6935e8e0662df242a/.github/workflows/schedule-performance-test.yaml#L21) | Runs Istio Manager's performance tests every day at 12:00 AM on a Gardener GCP cluster.                     |
| [`UI Tests Periodic / Build manager image`](https://github.com/kyma-project/istio/blob/f7232fffa2f4bb1d40e0cf8955fc4ffae3c3e89a/.github/workflows/schedule-ui-tests-periodic.yaml#L8)                  | Builds Kyma Istio Operator's image and pushes it to the `prod` registry. |
| [`UI Tests Periodic / Run UI tests`](https://github.com/kyma-project/istio/blob/f7232fffa2f4bb1d40e0cf8955fc4ffae3c3e89a/.github/workflows/schedule-ui-tests-periodic.yaml#L19)                | Runs UI tests for Busola extensions of Istio Module.                                                        |
| [`UI Tests Periodic / Slack Notification`](https://github.com/kyma-project/istio/blob/f7232fffa2f4bb1d40e0cf8955fc4ffae3c3e89a/.github/workflows/schedule-ui-tests-periodic.yaml#L44)         | Sends a Slack notification to the team's channel if any pipelines fail in the workflow.                     |
