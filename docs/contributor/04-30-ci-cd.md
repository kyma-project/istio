# CI/CD
The Istio module contains several pipelines that run on pull requests, on the main branch, on the release branch, and periodically. They perform various tasks such as running a linter, executing unit tests with code coverage, generating artifacts for development and production purposes, and running integration tests. The integration tests ensure the functional correctness of Kyma Istio Operator and verify if upgrading to the new version of Kyma Istio Operator is possible.

## Enforcing that the required actions always run

To ensure that the required actions always run, the Istio module uses GitHub ruleset.
This enforces all jobs that check whether a particular workflow should start to always run.

## Pipelines Running on Pull Requests to the Main Branch

The following CI jobs are part of the development cycle.

| Name                                                                                                                                                                                                        | Description                                                                                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| [`Pull Request pipeline / Wait for image build`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-request.yaml#L32)                               | Waits for the operator's image build to finish so that the image-dependent jobs can be executed.                                                       |
| [`pull-istio-operator-build`](https://github.com/kyma-project/test-infra/blob/578e4bb754b1bf12e1964cb96436bd25b7c21996/prow/jobs/kyma-project/istio/istio-manager.yaml#L6)                                  | Builds Kyma Istio Operator's image and pushes it to the `dev` registry.                                                                                |
| [`Pull Request integration tests / Istio integration test`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-integration.yaml#L31)                | Executes the main integration test suite for the Istio module on a k3d cluster.                                                                        |
| [`Pull Request integration tests / Istio integration test evaluation`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-integration.yaml#L45)     | Executes the main integration test suite for the Istio module in the evaluation profile on a k3d cluster.                                              |
| [`Pull Request integration tests / Kubernetes version compatibility test`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-integration.yaml#L10) | Executes the basic integration test suite for the Istio module and checks if any incompatibilities occurred during the execution.                      |
| [`Pull Request integration tests / Istio upgrade integration test`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-integration.yaml#L19)        | Executes the upgrade integration test suite for the Istio module and verifies if the existing release can be successfully upgraded to the new version. |
| [`Pull Request unit & lint / lint`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-unit-lint.yaml#L9)                                           | Performs linting.                                                                                                                                      |
| [`Pull Request unit & lint / Run unit tests`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-unit-lint.yaml#L24)                                | Runs unit tests with code coverage information.                                                                                                        |
| [`Pull Request unit & lint / Run unit tests with experimental build tag`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/pull-unit-lint.yaml#L39)    | Runs unit tests with experimental build tag.                                                                                                           |
| [`UI Tests / Run UI tests`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/ui-tests.yaml#L7)                                                         | Runs UI tests for Busola extensions of the Istio module.                                                                                               |
| [`Workflow validation / Ensure SHA pinned actions`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/verify-commit-pins.yaml#L7)                       | Verifies that all external actions are pinned to a commit.                                                                                             |
| [`pull-gitleaks / scan`](https://github.com/kyma-project/istio/blob/main/.github/workflows/pull-gitleaks.yaml#L10)                                                                                          | Runs the Gitleaks scan to detect any leaks of secrets.                                                                                                 |

## Pipelines Running on Merge to Main and All Release Branches

The following CI jobs run when you merge changes to the `main` branch and all release branches.

| Name                                                                                                                                                                                               | Description                                                                                                                                       |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|---------------------------------------------------------------------------------------------------------------------------------------------------|
| [`post-istio-operator-build`](https://github.com/kyma-project/test-infra/blob/578e4bb754b1bf12e1964cb96436bd25b7c21996/prow/jobs/kyma-project/istio/istio-manager.yaml#L117)                       | Builds Kyma Istio Operator's image and pushes it to the `prod` registry.                                                                          |
| [`post-istio-operator-experimental-build`](https://github.com/kyma-project/test-infra/blob/ca3de673baede44bb1167fe54cc43ec7909fe69d/prow/jobs/kyma-project/istio/istio-manager.yaml#L231)          | Builds Kyma Istio Operator's experimental image and pushes it to the `prod` registry.                                                             |
| [`main integration tests / Istio integration test`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/main-integration.yaml#L59)               | Executes the main integration test suite for Istio Manager on a k3d cluster.                                                                      |
| [`main integration tests / Istio integration test AWS specific`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/main-integration.yaml#L103) | Executes the integration test suite specific for AWS Hyperscaler.                                                                                 |
| [`main integration tests / Istio integration test GCP`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/main-integration.yaml#L133)          | Executes the integration test suite specific for GCP Hyperscaler.                                                                                 |
| [`main integration tests / Wait for image build`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/main-integration.yaml#L34)                 | Waits for the operator's image build to finish so that image-dependent jobs can be executed.                                                      |
| [`main integration tests / Istio upgrade integration tests`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/main-integration.yaml#L46)      | Executes the upgrade integration test suite of Istio Module and verifies if the existing release can be successfully upgraded to the new version. |
| [`main integration tests / Slack Notification`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/main-integration.yaml#L193)                  | Sends a Slack notification to the team's channel if any pipelines fail on the main branch.                                                        |

## Pipelines Running on Pull Requests to Release Branches

The following CI jobs generate release artifacts and verify the functional correctness of Istio Manager. They run on the PR to the release branch.

| Name                                                                                                                                                                                                        | Description                                                                                                                                            |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------|
| [`Wait for image build`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-integration.yaml#L23)                                                   | Waits for the operator's image build to finish so that the image-dependent jobs can be executed.                                                       |
| [`pull-istio-operator-build`](https://github.com/kyma-project/test-infra/blob/578e4bb754b1bf12e1964cb96436bd25b7c21996/prow/jobs/kyma-project/istio/istio-manager.yaml#L6)                                  | Builds Kyma Istio Operator's image and pushes it to the `dev` registry.                                                                                |
| [`Pull Request integration test / Istio integration test`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-integration.yaml#L59)                 | Executes the main integration test suite for the Istio module on a k3d cluster.                                                                        |
| [`Pull Request integration test / Istio integration test evaluation`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-integration.yaml#L75)      | Executes the main integration test suite for the Istio module in the evaluation profile on a k3d cluster.                                              |
| [`PR Integration Gardener / Istio integration test GCP`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-integration-gardener.yaml#L39)          | Executes the main integration test suite for the Istio module on a Gardener GCP cluster.                                                               |
| [`PR Integration Gardener / Istio integration test AWS specific`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-integration-gardener.yaml#L73) | Executes the integration test suite specific for AWS Hyperscaler.                                                                                      |
| [`Pull Request integration tests / Kubernetes version compatibility test`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-integration.yaml#L34) | Executes the basic integration test suite for the Istio module and checks if any incompatibilities occurred during the execution.                      |
| [`Pull Request integration tests / Istio upgrade integration test`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-integration.yaml#L45)        | Executes the upgrade integration test suite for the Istio module and verifies if the existing release can be successfully upgraded to the new version. |
| [`Pull Request / lint`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-request.yaml#L25)                                                        | Performs linting.                                                                                                                                      |
| [`Pull Request / Run unit tests`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/pull-request.yaml#L40)                                              | Runs unit tests with code coverage information.                                                                                                        |
| [`Pull Request / Run unit tests with experimental build tag`](https://github.com/kyma-project/istio/blob/aa2db2546d26b754a9289199359c945eac91b739/.github/workflows/pull-request.yaml#L57)                  | Runs unit tests with experimental build tag.                                                                                                           |
| [`UI Tests / Wait for image build`]()                                                                                                                                                                       | Waits for the operator's image build to finish so that the image-dependent jobs can be executed.                                                       |
| [`UI Tests / Run UI tests`](https://github.com/kyma-project/istio/blob/d91645ab9c8935da03f82ed87623663cf2a621ad/.github/workflows/ui-tests.yaml#L22)                                                        | Runs UI tests for Busola extenstions of Istio Module.                                                                                                  |

## Pipelines Running on the Release Branch

The following CI jobs generate release artifacts and verify the functional correctness of Kyma Istio Operator.

| Name                                                                                                                                                                            | Description                                                                                          |
|---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|------------------------------------------------------------------------------------------------------|
| [`Istio integration test`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/main-integration.yaml#L46)                     | Executes the main integration test suite for the Istio module on a k3d cluster.                      |
| [`rel-istio-build`](https://github.com/kyma-project/test-infra/blob/578e4bb754b1bf12e1964cb96436bd25b7c21996/prow/jobs/kyma-project/istio/istio-manager.yaml#L61)               | Builds Kyma Istio Operator's image on the release and pushes it to the `prod` registry.              |
| [`rel-istio-experimental-build`](https://github.com/kyma-project/test-infra/blob/ca3de673baede44bb1167fe54cc43ec7909fe69d/prow/jobs/kyma-project/istio/istio-manager.yaml#L117) | Builds Kyma Istio Operator's experimental image on the release and pushes it to the `prod` registry. |
| [`Create release / Check release prerequisites`](https://github.com/kyma-project/istio/blob/d91645ab9c8935da03f82ed87623663cf2a621ad/.github/workflows/create-release.yaml#L17) | Checks whether all pre-requesites for release are met                                                |
| [`Create release / Create draft release`](https://github.com/kyma-project/istio/blob/d91645ab9c8935da03f82ed87623663cf2a621ad/.github/workflows/create-release.yaml#L44)        | Create a draft release that will be updated with release artifacts                                   |
| [`Create release / Publish release`](https://github.com/kyma-project/istio/blob/d91645ab9c8935da03f82ed87623663cf2a621ad/.github/workflows/create-release.yaml#L76)             | Publish the previously created draft release                                                         |

## Pipelines Running on a Schedule

The following CI jobs are scheduled to run at specific times.

| Name                                                                                                                                                                         | Description                                                                             |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------|
| [`Istio performance test`](https://github.com/kyma-project/istio/blob/fd34803dd516c3b614fda4f5b9d9a4c8b46372bb/.github/workflows/performance-test.yaml#L10)                  | Runs Istio Manager's performance tests every day at 12:00 AM on a Gardener GCP cluster. |
| [`UI Tests Periodic / Run UI tests`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/ui-tests-periodic.yaml#L8)        | Runs UI tests for Busola extensions of Istio Module.                                    |
| [`UI Tests Periodic / Slack Notification`](https://github.com/kyma-project/istio/blob/65822779cbf899909088820ab009450e579199f8/.github/workflows/ui-tests-periodic.yaml#L32) | Sends a Slack notification to the team's channel if any pipelines fail in the workflow. |
